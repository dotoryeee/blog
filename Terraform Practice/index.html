
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Terraform%20Backend/">
      
      
        <link rel="next" href="../Terraform%20deploy%20VPC%20and%20Subnet/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.8">
    
    
      
        <title>Terraform Practice - dotoryeee's blog</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#terraform-practice" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="dotoryeee&#39;s blog" class="md-header__button md-logo" aria-label="dotoryeee's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            dotoryeee's blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Terraform Practice
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="dotoryeee&#39;s blog" class="md-nav__button md-logo" aria-label="dotoryeee's blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    dotoryeee's blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        title1 1
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../3-Tier%20Basic%20Infra/" class="md-nav__link">
        3-Tier 기본 인프라 구성
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../API%20Gateway%20with%20Lambda/" class="md-nav__link">
        API Gateway with Lambda
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Access%20S3%2C%20DynamoDB%20with%20Lambda/" class="md-nav__link">
        Access S3, DynamoDB with Lambda
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CICD%20on%20Single%20container/" class="md-nav__link">
        CICD on Single container
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Circle-CI%20basic/" class="md-nav__link">
        Circle-CI Basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker%20Proxy%20Layer%20for%20MySQL/" class="md-nav__link">
        Docker Proxy Layer for MySQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker%20basics/" class="md-nav__link">
        Docker basics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker%20compose%20web%20GUI/" class="md-nav__link">
        Docker compose and web GUI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Docker%20volume%20with%20MySQL/" class="md-nav__link">
        Docker volume with MySQL
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Failover%20for%20HA/" class="md-nav__link">
        Failover for HA
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Multi%20container%20CICD/" class="md-nav__link">
        Multi container CICD
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Project-1/" class="md-nav__link">
        Project - 1
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Prometheus%20and%20Grafana/" class="md-nav__link">
        Prometheus and Grafana
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Terraform%20AWS%20IAM/" class="md-nav__link">
        Terraform AWS IAM
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Terraform%20Backend/" class="md-nav__link">
        Terraform Backend
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Terraform Practice
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Terraform Practice
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-vpc-subnets-ec2-igw" class="md-nav__link">
    연습1 (VPC, Subnets, EC2, IGW)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-rds-bastion" class="md-nav__link">
    연습2 (RDS, Bastion)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-application-load-balancer" class="md-nav__link">
    연습3 (Application Load Balancer)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Terraform%20deploy%20VPC%20and%20Subnet/" class="md-nav__link">
        Terraform deploy VPC and Subnet
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Terraform%20deploy%20VPC/" class="md-nav__link">
        Terraform deploy VPC
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Transaction%20on%20GCP%20Spanner/" class="md-nav__link">
        Transaction on GCP Spanner
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../VPC%20Endpoint%20with%20Role/" class="md-nav__link">
        VPC Endpoint with Role
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-vpc-subnets-ec2-igw" class="md-nav__link">
    연습1 (VPC, Subnets, EC2, IGW)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-rds-bastion" class="md-nav__link">
    연습2 (RDS, Bastion)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-application-load-balancer" class="md-nav__link">
    연습3 (Application Load Balancer)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="terraform-practice">Terraform Practice</h1>
<aside>
💡 테라폼을 아키텍처를 연습해봅니다

</aside>

<ul>
<li>EC2에 SSH 접속을 위한 키페어 생성<ol>
<li>비밀키를 생성합니다</li>
</ol>
</li>
</ul>
<div class="highlight"><pre><span></span><code>ssh-keygen -t rsa -b 2048 -f ~/dotoryeee.pem -q -P 
</code></pre></div>
<pre><code>2. pem을 사용하려면 권한을 수정해야 합니다
</code></pre>
<div class="highlight"><pre><span></span><code>chmod 400 ~/dotoryeee.pem
</code></pre></div>
<pre><code>3. AWS에 넘겨줄 공개키를 생성합니다
</code></pre>
<div class="highlight"><pre><span></span><code>ssh-keygen -y -f ~/dotoryeee.pem &gt; ~/dotoryeee.pub
</code></pre></div>
<ul>
<li>
<p>Terraform Docs</p>
<p><a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs"></a></p>
</li>
<li>
<p>에러가 자주 났던 부분</p>
<ol>
<li>EC2 t2.micro는 서울기준 2a, 2c에서만 지원됩니다</li>
<li>VPC 사이더 범위가 서브넷보다 넓은지 확인</li>
<li>MySQL RDS생성시 allocated_storage값에 0은 불가능</li>
<li>DB인스턴스는 별도로 서브넷 그룹을 생성해야 함</li>
</ol>
</li>
</ul>
<div class="highlight"><pre><span></span><code>Error: Error creating DB Instance: InvalidParameterCombination: The DB instance and EC2 security group are in different VPCs. The DB instance is in vpc-7ae25b11 and the EC2 security group is in vpc-07d48e73dba07404a
status code: 400, request id: 25f97e75-89d9-4323-9cd3-b09e83675d4e on [rds.tf](http://rds.tf/) line 16, in resource &quot;aws_db_instance&quot; &quot;rds&quot;:
16: resource &quot;aws_db_instance&quot; &quot;rds&quot; {
</code></pre></div>
<pre><code>5. RDS는 반드시 서브넷 2개 이상을 묶어서 구성
6. 베스천 호스트 사용하는 RDS는 당연시 퍼블릭 엑세스 제한
</code></pre>
<div class="highlight"><pre><span></span><code>Error: Error creating DB Instance: InvalidVPCNetworkStateFault: Cannot create a publicly accessible DBInstance.  The specified VPC does not support DNS resolution, DNS hostnames, or both. Update the VPC and then try again
status code: 400, request id: d26672f9-7f0a-40ac-9e17-6fd0b9fa2558
</code></pre></div>
<pre><code>7. ssh 접속을 위한 map_public_ip_on_launch (서브넷) 당연히 true
8. RDS는 생성에 오랜 시간이 걸리는 점 유의

    ![Terraform Practice/Untitled.png](Terraform Practice/Untitled.png)

9. 보안그룸 이름은 소문자 sg로 시작할 수 없음
10. RDS 보안그룹은 security_group_names 대신 vpc_security_group_ids 사용
</code></pre>
<div class="highlight"><pre><span></span><code>Error: Error creating DB Instance: InvalidParameterCombination: DB Security Groups can only be associated with VPC DB Instances using API versions 2012-01-15 through 2012-09-17.
</code></pre></div>
<h2 id="1-vpc-subnets-ec2-igw">연습1 (VPC, Subnets, EC2, IGW)</h2>
<hr />
<ul>
<li>
<p>구성</p>
<p><img alt="Terraform Practice/Untitled%201.png" src="Untitled%201.png" /></p>
</li>
<li>
<p>코드</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>#---------------VPC-----------------
resource &quot;aws_vpc&quot; &quot;main&quot; {
    cidr_block = &quot;10.0.0.0/16&quot;
    instance_tenancy = &quot;default&quot; #전용인스턴스 사용, default는 사용 하지 않음을 의미
    enable_dns_hostnames = true

    tags = {
        Name = &quot;vpc_practice_01&quot;
    }
}
#---------------IGW-----------------
resource &quot;aws_internet_gateway&quot; &quot;default&quot; {
    vpc_id = aws_vpc.main.id

    tags = {
        Name = &quot;igw_practice_01&quot;
    }
}
#---------------Subnet-----------------
resource &quot;aws_subnet&quot; &quot;public_01&quot; {
    vpc_id = aws_vpc.main.id

    cidr_block = &quot;10.0.0.0/24&quot;
    availability_zone = &quot;ap-northeast-2a&quot;

    map_public_ip_on_launch = true

    tags = {
        Name = &quot;public_subnet_01&quot;
    }
}
resource &quot;aws_subnet&quot; &quot;public_02&quot; {
    vpc_id = aws_vpc.main.id

    cidr_block = &quot;10.0.1.0/24&quot;
    availability_zone = &quot;ap-northeast-2c&quot;

    map_public_ip_on_launch = true

    tags = {
        Name = &quot;public_subnet_02&quot;
    }
}
#--------------Association--------------
resource &quot;aws_route_table_association&quot; &quot;public_01_association&quot; {
    subnet_id = aws_subnet.public_01.id
    route_table_id = aws_route_table.public.id
}

resource &quot;aws_route_table_association&quot; &quot;public_02_association&quot; {
    subnet_id = aws_subnet.public_02.id
    route_table_id = aws_route_table.public.id
}
#-------------Route table---------------
resource &quot;aws_route_table&quot; &quot;public&quot; {
    vpc_id = aws_vpc.main.id

    tags = {
        Name = &quot;public_route_table&quot;
    }
}
#-----------Route table Routes------------
resource &quot;aws_route&quot; &quot;public_sub_IGW&quot; {
    route_table_id = aws_route_table.public.id
    destination_cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_internet_gateway.default.id
}
#----------Security Group for EC2----------
resource &quot;aws_security_group&quot; &quot;practice_01&quot; {
    vpc_id = aws_vpc.main.id
    name = &quot;practice_01_SG&quot;
    description = &quot;SG_for_EC2&quot;

    #-----------인바운드-----------
    ingress {
        from_port = 22
        to_port = 22
        protocol = &quot;tcp&quot;
        cidr_blocks = [&quot;0.0.0.0/0&quot;]
        description = &quot;open SSH from Anywhere&quot;
    }

    #----------아웃바운드-----------
    egress {
        from_port = 0 #모든 포트
        to_port = 0 
        protocol = &quot;-1&quot; #모든 프로토콜
        cidr_blocks = [&quot;0.0.0.0/0&quot;] #리스트 형태도 가능
        description = &quot;open all port from anywhere&quot;
    }
}
#----------ready Public Key--------------
resource &quot;aws_key_pair&quot; &quot;practice_01&quot; {
    key_name = &quot;practice_01&quot;
    public_key = &quot;ssh-rsa...... 키 삭제&quot;
}
#---------public_01  EC2 Instance---------
resource &quot;aws_instance&quot; &quot;dotoryeee-EC2-01&quot; {
    ami = &quot;ami-006e2f9fa7597680a&quot;
    instance_type = &quot;t2.micro&quot;

    subnet_id = aws_subnet.public_01.id

    key_name = aws_key_pair.practice_01.key_name

    security_groups = [aws_security_group.practice_01.id]

    tags = {
        Name = &quot;doto_EC2_01&quot;
    }
}
#---------public_02  EC2 Instance---------
resource &quot;aws_instance&quot; &quot;dotoryeee-EC2-02&quot; {
    ami = &quot;ami-006e2f9fa7597680a&quot;
    instance_type = &quot;t2.micro&quot;

    subnet_id = aws_subnet.public_02.id

    key_name = aws_key_pair.practice_01.key_name

    security_groups = [aws_security_group.practice_01.id]

    tags = {
        Name = &quot;doto_EC2_02&quot;
    }
}
</code></pre></div>
<ul>
<li>terraform apply</li>
</ul>
<div class="highlight"><pre><span></span><code>An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_instance.dotoryeee-EC2-01 will be created
  + resource &quot;aws_instance&quot; &quot;dotoryeee-EC2-01&quot; {
      + ami                          = &quot;ami-006e2f9fa7597680a&quot;
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = &quot;t2.micro&quot;
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = &quot;practice_01&quot;
      + outpost_arn                  = (known after apply)
      + password_data                = (known after apply)
      + placement_group              = (known after apply)
      + primary_network_interface_id = (known after apply)
      + private_dns                  = (known after apply)
      + private_ip                   = (known after apply)
      + public_dns                   = (known after apply)
      + public_ip                    = (known after apply)
      + secondary_private_ips        = (known after apply)
      + security_groups              = (known after apply)
      + subnet_id                    = (known after apply)
      + tags                         = {
          + &quot;Name&quot; = &quot;doto_EC2_01&quot;
        }
      + tenancy                      = (known after apply)
      + vpc_security_group_ids       = (known after apply)

      + ebs_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + snapshot_id           = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }

      + enclave_options {
          + enabled = (known after apply)
        }

      + ephemeral_block_device {
          + device_name  = (known after apply)
          + no_device    = (known after apply)
          + virtual_name = (known after apply)
        }

      + metadata_options {
          + http_endpoint               = (known after apply)
          + http_put_response_hop_limit = (known after apply)
          + http_tokens                 = (known after apply)
        }

      + network_interface {
          + delete_on_termination = false
          + device_index          = 0
          + network_interface_id  = (known after apply)
        }

      + root_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }
    }

  # aws_instance.dotoryeee-EC2-02 will be created
  + resource &quot;aws_instance&quot; &quot;dotoryeee-EC2-02&quot; {
      + ami                          = &quot;ami-006e2f9fa7597680a&quot;
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = &quot;t2.micro&quot;
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = &quot;practice_01&quot;
      + outpost_arn                  = (known after apply)
      + password_data                = (known after apply)
      + placement_group              = (known after apply)
      + primary_network_interface_id = (known after apply)
      + private_dns                  = (known after apply)
      + private_ip                   = (known after apply)
      + public_dns                   = (known after apply)
      + public_ip                    = (known after apply)
      + secondary_private_ips        = (known after apply)
      + security_groups              = (known after apply)
      + subnet_id                    = (known after apply)
      + tags                         = {
          + &quot;Name&quot; = &quot;doto_EC2_02&quot;
        }
      + tenancy                      = (known after apply)
      + vpc_security_group_ids       = (known after apply)

      + ebs_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + snapshot_id           = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }

      + enclave_options {
          + enabled = (known after apply)
        }

      + ephemeral_block_device {
          + device_name  = (known after apply)
          + no_device    = (known after apply)
          + virtual_name = (known after apply)
        }

      + metadata_options {
          + http_endpoint               = (known after apply)
          + http_put_response_hop_limit = (known after apply)
          + http_tokens                 = (known after apply)
        }

      + network_interface {
          + delete_on_termination = false
          + device_index          = 0
          + network_interface_id  = (known after apply)
        }

      + root_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }
    }

  # aws_internet_gateway.default will be created
  + resource &quot;aws_internet_gateway&quot; &quot;default&quot; {
      + arn      = (known after apply)
      + id       = (known after apply)
      + owner_id = (known after apply)
      + tags     = {
          + &quot;Name&quot; = &quot;igw_practice_01&quot;
        }
      + vpc_id   = (known after apply)
    }

  # aws_key_pair.practice_01 will be created
  + resource &quot;aws_key_pair&quot; &quot;practice_01&quot; {
      + arn         = (known after apply)
      + fingerprint = (known after apply)
      + id          = (known after apply)
      + key_name    = &quot;practice_01&quot;
      + key_pair_id = (known after apply)
      + public_key  = &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDD5D5mHSD/vdgcGmh6Kd57DqLxebcvbrUsHj8DYDW0+9MSvvK874Bm4hpqHliYze/ht7VnzL5+A5qZkCevKGBDeJNmR/QDHccCsCfRuyEmzMlvj3SxzYSH2N4lBG6eZZbQ+0yRl7ny3aeyol5boDkztLZ/PZwVR5IH6BgsNiGClSDtuf2CYoKN7hQufjeuCDcLlQa+ItFa4abMe/mWtMeEh7+ZpC+0KAFFvqY80OCtuUdqq7tcP8uHzQy9mPKvKBieJYitUoStjFEMAro1v34u6193Qgk6DAhyMom4GmLc2+tTyKMsvBlRKUOb87F+2zsATX3Ahz9cMpEkfPTkY15V dotoryeee@i5-6500&quot;
    }

  # aws_network_interface.public_01 will be created
  + resource &quot;aws_network_interface&quot; &quot;public_01&quot; {
      + id                 = (known after apply)
      + ipv6_address_count = (known after apply)
      + ipv6_addresses     = (known after apply)
      + mac_address        = (known after apply)
      + outpost_arn        = (known after apply)
      + private_dns_name   = (known after apply)
      + private_ip         = (known after apply)
      + private_ips        = (known after apply)
      + private_ips_count  = (known after apply)
      + security_groups    = (known after apply)
      + source_dest_check  = true
      + subnet_id          = (known after apply)
      + tags               = {
          + &quot;Name&quot; = &quot;interface_public_01&quot;
        }

      + attachment {
          + attachment_id = (known after apply)
          + device_index  = (known after apply)
          + instance      = (known after apply)
        }
    }

  # aws_network_interface.public_02 will be created
  + resource &quot;aws_network_interface&quot; &quot;public_02&quot; {
      + id                 = (known after apply)
      + ipv6_address_count = (known after apply)
      + ipv6_addresses     = (known after apply)
      + mac_address        = (known after apply)
      + outpost_arn        = (known after apply)
      + private_dns_name   = (known after apply)
      + private_ip         = (known after apply)
      + private_ips        = (known after apply)
      + private_ips_count  = (known after apply)
      + security_groups    = (known after apply)
      + source_dest_check  = true
      + subnet_id          = (known after apply)
      + tags               = {
          + &quot;Name&quot; = &quot;interface_public_02&quot;
        }

      + attachment {
          + attachment_id = (known after apply)
          + device_index  = (known after apply)
          + instance      = (known after apply)
        }
    }

  # aws_route.public_sub_IGW will be created
  + resource &quot;aws_route&quot; &quot;public_sub_IGW&quot; {
      + destination_cidr_block     = &quot;0.0.0.0/0&quot;
      + destination_prefix_list_id = (known after apply)
      + egress_only_gateway_id     = (known after apply)
      + gateway_id                 = (known after apply)
      + id                         = (known after apply)
      + instance_id                = (known after apply)
      + instance_owner_id          = (known after apply)
      + local_gateway_id           = (known after apply)
      + nat_gateway_id             = (known after apply)
      + network_interface_id       = (known after apply)
      + origin                     = (known after apply)
      + route_table_id             = (known after apply)
      + state                      = (known after apply)
    }

  # aws_route_table.public will be created
  + resource &quot;aws_route_table&quot; &quot;public&quot; {
      + id               = (known after apply)
      + owner_id         = (known after apply)
      + propagating_vgws = (known after apply)
      + route            = (known after apply)
      + tags             = {
          + &quot;Name&quot; = &quot;public_route_table&quot;
        }
      + vpc_id           = (known after apply)
    }

  # aws_route_table_association.public_01_association will be created
  + resource &quot;aws_route_table_association&quot; &quot;public_01_association&quot; {
      + id             = (known after apply)
      + route_table_id = (known after apply)
      + subnet_id      = (known after apply)
    }

  # aws_route_table_association.public_02_association will be created
  + resource &quot;aws_route_table_association&quot; &quot;public_02_association&quot; {
      + id             = (known after apply)
      + route_table_id = (known after apply)
      + subnet_id      = (known after apply)
    }

  # aws_security_group.practice_01 will be created
  + resource &quot;aws_security_group&quot; &quot;practice_01&quot; {
      + arn                    = (known after apply)
      + description            = &quot;SG_for_EC2&quot;
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + &quot;0.0.0.0/0&quot;,
                ]
              + description      = &quot;open all port from anywhere&quot;
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = &quot;-1&quot;
              + security_groups  = []
              + self             = false
              + to_port          = 0
            },
        ]
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = [
                  + &quot;0.0.0.0/0&quot;,
                ]
              + description      = &quot;open SSH from Anywhere&quot;
              + from_port        = 22
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = &quot;tcp&quot;
              + security_groups  = []
              + self             = false
              + to_port          = 22
            },
        ]
      + name                   = &quot;practice_01_SG&quot;
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + vpc_id                 = (known after apply)
    }

  # aws_subnet.public_01 will be created
  + resource &quot;aws_subnet&quot; &quot;public_01&quot; {
      + arn                             = (known after apply)
      + assign_ipv6_address_on_creation = false
      + availability_zone               = &quot;ap-northeast-2a&quot;
      + availability_zone_id            = (known after apply)
      + cidr_block                      = &quot;10.0.0.0/24&quot;
      + id                              = (known after apply)
      + ipv6_cidr_block_association_id  = (known after apply)
      + map_public_ip_on_launch         = true
      + owner_id                        = (known after apply)
      + tags                            = {
          + &quot;Name&quot; = &quot;public_subnet_01&quot;
        }
      + vpc_id                          = (known after apply)
    }

  # aws_subnet.public_02 will be created
  + resource &quot;aws_subnet&quot; &quot;public_02&quot; {
      + arn                             = (known after apply)
      + assign_ipv6_address_on_creation = false
      + availability_zone               = &quot;ap-northeast-2c&quot;
      + availability_zone_id            = (known after apply)
      + cidr_block                      = &quot;10.0.1.0/24&quot;
      + id                              = (known after apply)
      + ipv6_cidr_block_association_id  = (known after apply)
      + map_public_ip_on_launch         = true
      + owner_id                        = (known after apply)
      + tags                            = {
          + &quot;Name&quot; = &quot;public_subnet_02&quot;
        }
      + vpc_id                          = (known after apply)
    }

  # aws_vpc.main will be created
  + resource &quot;aws_vpc&quot; &quot;main&quot; {
      + arn                              = (known after apply)
      + assign_generated_ipv6_cidr_block = false
      + cidr_block                       = &quot;10.0.0.0/16&quot;
      + default_network_acl_id           = (known after apply)
      + default_route_table_id           = (known after apply)
      + default_security_group_id        = (known after apply)
      + dhcp_options_id                  = (known after apply)
      + enable_classiclink               = (known after apply)
      + enable_classiclink_dns_support   = (known after apply)
      + enable_dns_hostnames             = true
      + enable_dns_support               = true
      + id                               = (known after apply)
      + instance_tenancy                 = &quot;default&quot;
      + ipv6_association_id              = (known after apply)
      + ipv6_cidr_block                  = (known after apply)
      + main_route_table_id              = (known after apply)
      + owner_id                         = (known after apply)
      + tags                             = {
          + &quot;Name&quot; = &quot;vpc_practice_01&quot;
        }
    }

Plan: 14 to add, 0 to change, 0 to destroy.
</code></pre></div>
<ul>
<li>
<p>결과</p>
<p><img alt="Terraform Practice/Untitled%202.png" src="Untitled%202.png" /></p>
<p><img alt="Terraform Practice/Untitled%203.png" src="Untitled%203.png" /></p>
<p><img alt="EC2 SSH 접속까지 성공" src="Untitled%204.png" /></p>
<p>EC2 SSH 접속까지 성공</p>
</li>
</ul>
<h2 id="2-rds-bastion">연습2 (RDS, Bastion)</h2>
<hr />
<ul>
<li>
<p>구성</p>
<p><img alt="Terraform Practice/Untitled%205.png" src="Untitled%205.png" /></p>
</li>
<li>
<p>코드</p>
<ul>
<li>variables.tf</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code>variable &quot;aws_region&quot; {
  description = &quot;region for AWS&quot;
}

variable &quot;vpc_name&quot; {
  description = &quot;name for practice_02 VPC&quot;
}

variable &quot;subnet_name&quot; {
}

variable &quot;instance_names&quot; {
  type = list(string)
}

variable &quot;az&quot; {
  type    = list(string)
  default = [&quot;ap-northeast-2a&quot;]
}

variable &quot;ami_id_maps&quot; {
  type    = map(any)
  default = {}
}

variable &quot;instance_type&quot; {
}
</code></pre></div>
<pre><code>- terraform.tfvars
</code></pre>
<div class="highlight"><pre><span></span><code>aws_region = &quot;ap-northeast-2&quot;

vpc_name = &quot;vpc_practice_02&quot;

subnet_name = &quot;subnet_practice_02&quot;

az = [
    &quot;ap-northeast-2a&quot;, 
    &quot;ap-northeast-2c&quot;
]

instance_names = [
    &quot;public-01&quot;, 
    &quot;public-02&quot;
]

ami_id_maps = {
    amazon_linux_2 = &quot;ami-006e2f9fa7597680a&quot;
    ubuntu_20_04 = &quot;ami-00f1068284b9eca92&quot;
}

instance_type = &quot;t2.micro&quot;
</code></pre></div>
<ul>
<li>provider.tf</li>
</ul>
<div class="highlight"><pre><span></span><code>provider &quot;aws&quot; {
  region = var.aws_region
}
</code></pre></div>
<ul>
<li>vpc.tf</li>
</ul>
<div class="highlight"><pre><span></span><code>#------------VPC-------------
resource &quot;aws_vpc&quot; &quot;main&quot; {
  cidr_block       = &quot;10.0.0.0/16&quot;
  instance_tenancy = &quot;default&quot;

  enable_dns_support = &quot;true&quot;

  tags = {
    Name = var.vpc_name
  }
}
################PUBLIC SUBNET#################
#-------------IGW---------------
resource &quot;aws_internet_gateway&quot; &quot;default&quot; {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = &quot;practice_02&quot;
  }
}
#------------subnet-------------
resource &quot;aws_subnet&quot; &quot;public&quot; {
  vpc_id     = aws_vpc.main.id
  cidr_block = &quot;10.0.0.0/24&quot;

  availability_zone = var.az[0]

  map_public_ip_on_launch = true

  tags = {
    &quot;Name&quot; = &quot;public_subnet&quot;
  }
}
#------------association-------------
resource &quot;aws_route_table_association&quot; &quot;association1&quot; {
  subnet_id      = aws_subnet.public.id
  route_table_id = aws_route_table.public.id
}
#------------router table------------
resource &quot;aws_route_table&quot; &quot;public&quot; {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_internet_gateway.default.id
  }

  tags = {
    &quot;Name&quot; = &quot;public_table&quot;
  }
}
################PRIVATE SUBNET#################
#-------------subnet-------------
resource &quot;aws_subnet&quot; &quot;private&quot; {
  vpc_id = aws_vpc.main.id

  availability_zone = var.az[0]

  cidr_block = &quot;10.0.1.0/24&quot;
}

resource &quot;aws_subnet&quot; &quot;private2&quot; {
  vpc_id = aws_vpc.main.id

  availability_zone = var.az[1]

  cidr_block = &quot;10.0.2.0/24&quot;
}
</code></pre></div>
<ul>
<li>ec2.tf</li>
</ul>
<div class="highlight"><pre><span></span><code>#----------------SG---------------------
resource &quot;aws_security_group&quot; &quot;public_ec2&quot; {
  vpc_id = aws_vpc.main.id

  name        = &quot;allow SSH&quot;
  description = &quot;allow SSH from anywhere&quot;

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = &quot;tcp&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = &quot;-1&quot;
    cidr_blocks = [&quot;0.0.0.0/0&quot;]
  }

  tags = {
    &quot;Name&quot; = &quot;SG-for-publicEC2&quot;
  }
}
#-------------Key pair--------------
resource &quot;aws_key_pair&quot; &quot;dotoryeee&quot; {
  key_name   = &quot;dotoryeee&quot;
  public_key = &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDD5D5mHSD/vdgcGmh6Kd57DqLxebcvbrUsHj8DYDW0+9MSvvK874Bm4hpqHliYze/ht7VnzL5+A5qZkCevKGBDeJNmR/QDHccCsCfRuyEmzMlvj3SxzYSH2N4lBG6eZZbQ+0yRl7ny3aeyol5boDkztLZ/PZwVR5IH6BgsNiGClSDtuf2CYoKN7hQufjeuCDcLlQa+ItFa4abMe/mWtMeEh7+ZpC+0KAFFvqY80OCtuUdqq7tcP8uHzQy9mPKvKBieJYitUoStjFEMAro1v34u6193Qgk6DAhyMom4GmLc2+tTyKMsvBlRKUOb87F+2zsATX3Ahz9cMpEkfPTkY15V dotoryeee@i5-6500&quot;
}
#----------------EC2---------------------
resource &quot;aws_instance&quot; &quot;public_01&quot; {
  ami           = var.ami_id_maps[&quot;amazon_linux_2&quot;]
  instance_type = var.instance_type

  subnet_id = aws_subnet.public.id

  security_groups = [aws_security_group.public_ec2.id]

  key_name = aws_key_pair.dotoryeee.key_name

  tags = {
    Name = var.instance_names[0]
  }
}

resource &quot;aws_instance&quot; &quot;public_02&quot; {
  ami           = var.ami_id_maps[&quot;ubuntu_20_04&quot;]
  instance_type = var.instance_type

  subnet_id = aws_subnet.public.id

  security_groups = [aws_security_group.public_ec2.id]

  key_name = aws_key_pair.dotoryeee.key_name

  tags = {
    Name = var.instance_names[1]
  }
}
</code></pre></div>
<ul>
<li>rds.tf</li>
</ul>
<div class="highlight"><pre><span></span><code>#--------------Security Group----------------
resource &quot;aws_security_group&quot; &quot;rds&quot; {
  vpc_id = aws_vpc.main.id
  name   = &quot;SG-for-RDS&quot;

  ingress {
    from_port       = 3306
    to_port         = 3306
    protocol        = &quot;tcp&quot;
    security_groups = [aws_security_group.public_ec2.id]
  }
}
#---------------RDS Subnet Group--------
resource &quot;aws_db_subnet_group&quot; &quot;_&quot; {
  name = &quot;subnet_for_rds&quot;
  subnet_ids = [
    aws_subnet.private.id,
    aws_subnet.private2.id
  ]
}
#----------------RDS instance-------------
resource &quot;aws_db_instance&quot; &quot;_&quot; {
  #settings for Free tier
  instance_class      = &quot;db.t2.micro&quot;
  skip_final_snapshot = true
  allocated_storage   = 10
  engine              = &quot;mysql&quot;
  engine_version      = &quot;5.7&quot;
  #settings for Free tier

  identifier = &quot;demodb&quot;
  username   = &quot;root&quot;
  password   = &quot;password&quot;
  name       = &quot;mydb&quot;

  db_subnet_group_name = aws_db_subnet_group._.name

  vpc_security_group_ids = [aws_security_group.rds.id]
}
</code></pre></div>
<ul>
<li>terraform apply</li>
</ul>
<div class="highlight"><pre><span></span><code>An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # aws_db_instance._ will be created
  + resource &quot;aws_db_instance&quot; &quot;_&quot; {
      + address                               = (known after apply)
      + allocated_storage                     = 10
      + apply_immediately                     = (known after apply)
      + arn                                   = (known after apply)
      + auto_minor_version_upgrade            = true
      + availability_zone                     = (known after apply)
      + backup_retention_period               = (known after apply)
      + backup_window                         = (known after apply)
      + ca_cert_identifier                    = (known after apply)
      + character_set_name                    = (known after apply)
      + copy_tags_to_snapshot                 = false
      + db_subnet_group_name                  = &quot;subnet_for_rds&quot;
      + delete_automated_backups              = true
      + endpoint                              = (known after apply)
      + engine                                = &quot;mysql&quot;
      + engine_version                        = &quot;5.7&quot;
      + hosted_zone_id                        = (known after apply)
      + id                                    = (known after apply)
      + identifier                            = &quot;demodb&quot;
      + identifier_prefix                     = (known after apply)
      + instance_class                        = &quot;db.t2.micro&quot;
      + kms_key_id                            = (known after apply)
      + latest_restorable_time                = (known after apply)
      + license_model                         = (known after apply)
      + maintenance_window                    = (known after apply)
      + monitoring_interval                   = 0
      + monitoring_role_arn                   = (known after apply)
      + multi_az                              = (known after apply)
      + name                                  = &quot;mydb&quot;
      + option_group_name                     = (known after apply)
      + parameter_group_name                  = (known after apply)
      + password                              = (sensitive value)
      + performance_insights_enabled          = false
      + performance_insights_kms_key_id       = (known after apply)
      + performance_insights_retention_period = (known after apply)
      + port                                  = (known after apply)
      + publicly_accessible                   = false
      + replicas                              = (known after apply)
      + resource_id                           = (known after apply)
      + skip_final_snapshot                   = true
      + status                                = (known after apply)
      + storage_type                          = (known after apply)
      + timezone                              = (known after apply)
      + username                              = &quot;root&quot;
      + vpc_security_group_ids                = (known after apply)
    }

  # aws_db_subnet_group._ will be created
  + resource &quot;aws_db_subnet_group&quot; &quot;_&quot; {
      + arn         = (known after apply)
      + description = &quot;Managed by Terraform&quot;
      + id          = (known after apply)
      + name        = &quot;subnet_for_rds&quot;
      + name_prefix = (known after apply)
      + subnet_ids  = (known after apply)
    }

  # aws_instance.public_01 will be created
  + resource &quot;aws_instance&quot; &quot;public_01&quot; {
      + ami                          = &quot;ami-006e2f9fa7597680a&quot;
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = &quot;t2.micro&quot;
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = &quot;dotoryeee&quot;
      + outpost_arn                  = (known after apply)
      + password_data                = (known after apply)
      + placement_group              = (known after apply)
      + primary_network_interface_id = (known after apply)
      + private_dns                  = (known after apply)
      + private_ip                   = (known after apply)
      + public_dns                   = (known after apply)
      + public_ip                    = (known after apply)
      + secondary_private_ips        = (known after apply)
      + security_groups              = (known after apply)
      + source_dest_check            = true
      + subnet_id                    = (known after apply)
      + tags                         = {
          + &quot;Name&quot; = &quot;public-01&quot;
        }
      + tenancy                      = (known after apply)
      + vpc_security_group_ids       = (known after apply)

      + ebs_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + snapshot_id           = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }

      + enclave_options {
          + enabled = (known after apply)
        }

      + ephemeral_block_device {
          + device_name  = (known after apply)
          + no_device    = (known after apply)
          + virtual_name = (known after apply)
        }

      + metadata_options {
          + http_endpoint               = (known after apply)
          + http_put_response_hop_limit = (known after apply)
          + http_tokens                 = (known after apply)
        }

      + network_interface {
          + delete_on_termination = (known after apply)
          + device_index          = (known after apply)
          + network_interface_id  = (known after apply)
        }

      + root_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }
    }

  # aws_instance.public_02 will be created
  + resource &quot;aws_instance&quot; &quot;public_02&quot; {
      + ami                          = &quot;ami-00f1068284b9eca92&quot;
      + arn                          = (known after apply)
      + associate_public_ip_address  = (known after apply)
      + availability_zone            = (known after apply)
      + cpu_core_count               = (known after apply)
      + cpu_threads_per_core         = (known after apply)
      + get_password_data            = false
      + host_id                      = (known after apply)
      + id                           = (known after apply)
      + instance_state               = (known after apply)
      + instance_type                = &quot;t2.micro&quot;
      + ipv6_address_count           = (known after apply)
      + ipv6_addresses               = (known after apply)
      + key_name                     = &quot;dotoryeee&quot;
      + outpost_arn                  = (known after apply)
      + password_data                = (known after apply)
      + placement_group              = (known after apply)
      + primary_network_interface_id = (known after apply)
      + private_dns                  = (known after apply)
      + private_ip                   = (known after apply)
      + public_dns                   = (known after apply)
      + public_ip                    = (known after apply)
      + secondary_private_ips        = (known after apply)
      + security_groups              = (known after apply)
      + source_dest_check            = true
      + subnet_id                    = (known after apply)
      + tags                         = {
          + &quot;Name&quot; = &quot;public-02&quot;
        }
      + tenancy                      = (known after apply)
      + vpc_security_group_ids       = (known after apply)

      + ebs_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + snapshot_id           = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }

      + enclave_options {
          + enabled = (known after apply)
        }

      + ephemeral_block_device {
          + device_name  = (known after apply)
          + no_device    = (known after apply)
          + virtual_name = (known after apply)
        }

      + metadata_options {
          + http_endpoint               = (known after apply)
          + http_put_response_hop_limit = (known after apply)
          + http_tokens                 = (known after apply)
        }

      + network_interface {
          + delete_on_termination = (known after apply)
          + device_index          = (known after apply)
          + network_interface_id  = (known after apply)
        }

      + root_block_device {
          + delete_on_termination = (known after apply)
          + device_name           = (known after apply)
          + encrypted             = (known after apply)
          + iops                  = (known after apply)
          + kms_key_id            = (known after apply)
          + tags                  = (known after apply)
          + throughput            = (known after apply)
          + volume_id             = (known after apply)
          + volume_size           = (known after apply)
          + volume_type           = (known after apply)
        }
    }

  # aws_internet_gateway.default will be created
  + resource &quot;aws_internet_gateway&quot; &quot;default&quot; {
      + arn      = (known after apply)
      + id       = (known after apply)
      + owner_id = (known after apply)
      + tags     = {
          + &quot;Name&quot; = &quot;practice_02&quot;
        }
      + vpc_id   = (known after apply)
    }

  # aws_key_pair.dotoryeee will be created
  + resource &quot;aws_key_pair&quot; &quot;dotoryeee&quot; {
      + arn         = (known after apply)
      + fingerprint = (known after apply)
      + id          = (known after apply)
      + key_name    = &quot;dotoryeee&quot;
      + key_pair_id = (known after apply)
      + public_key  = &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDD5D5mHSD/vdgcGmh6Kd57DqLxebcvbrUsHj8DYDW0+9MSvvK874Bm4hpqHliYze/ht7VnzL5+A5qZkCevKGBDeJNmR/QDHccCsCfRuyEmzMlvj3SxzYSH2N4lBG6eZZbQ+0yRl7ny3aeyol5boDkztLZ/PZwVR5IH6BgsNiGClSDtuf2CYoKN7hQufjeuCDcLlQa+ItFa4abMe/mWtMeEh7+ZpC+0KAFFvqY80OCtuUdqq7tcP8uHzQy9mPKvKBieJYitUoStjFEMAro1v34u6193Qgk6DAhyMom4GmLc2+tTyKMsvBlRKUOb87F+2zsATX3Ahz9cMpEkfPTkY15V dotoryeee@i5-6500&quot;
    }

  # aws_route_table.public will be created
  + resource &quot;aws_route_table&quot; &quot;public&quot; {
      + id               = (known after apply)
      + owner_id         = (known after apply)
      + propagating_vgws = (known after apply)
      + route            = [
          + {
              + cidr_block                = &quot;0.0.0.0/0&quot;
              + egress_only_gateway_id    = &quot;&quot;
              + gateway_id                = (known after apply)
              + instance_id               = &quot;&quot;
              + ipv6_cidr_block           = &quot;&quot;
              + local_gateway_id          = &quot;&quot;
              + nat_gateway_id            = &quot;&quot;
              + network_interface_id      = &quot;&quot;
              + transit_gateway_id        = &quot;&quot;
              + vpc_endpoint_id           = &quot;&quot;
              + vpc_peering_connection_id = &quot;&quot;
            },
        ]
      + tags             = {
          + &quot;Name&quot; = &quot;public_table&quot;
        }
      + vpc_id           = (known after apply)
    }

  # aws_route_table_association.association1 will be created
  + resource &quot;aws_route_table_association&quot; &quot;association1&quot; {
      + id             = (known after apply)
      + route_table_id = (known after apply)
      + subnet_id      = (known after apply)
    }

  # aws_security_group.public_ec2 will be created
  + resource &quot;aws_security_group&quot; &quot;public_ec2&quot; {
      + arn                    = (known after apply)
      + description            = &quot;allow SSH from anywhere&quot;
      + egress                 = [
          + {
              + cidr_blocks      = [
                  + &quot;0.0.0.0/0&quot;,
                ]
              + description      = &quot;&quot;
              + from_port        = 0
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = &quot;-1&quot;
              + security_groups  = []
              + self             = false
              + to_port          = 0
            },
        ]
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = [
                  + &quot;0.0.0.0/0&quot;,
                ]
              + description      = &quot;&quot;
              + from_port        = 22
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = &quot;tcp&quot;
              + security_groups  = []
              + self             = false
              + to_port          = 22
            },
        ]
      + name                   = &quot;allow SSH&quot;
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + tags                   = {
          + &quot;Name&quot; = &quot;SG-for-publicEC2&quot;
        }
      + vpc_id                 = (known after apply)
    }

  # aws_security_group.rds will be created
  + resource &quot;aws_security_group&quot; &quot;rds&quot; {
      + arn                    = (known after apply)
      + description            = &quot;Managed by Terraform&quot;
      + egress                 = (known after apply)
      + id                     = (known after apply)
      + ingress                = [
          + {
              + cidr_blocks      = []
              + description      = &quot;&quot;
              + from_port        = 3306
              + ipv6_cidr_blocks = []
              + prefix_list_ids  = []
              + protocol         = &quot;tcp&quot;
              + security_groups  = (known after apply)
              + self             = false
              + to_port          = 3306
            },
        ]
      + name                   = &quot;SG-for-RDS&quot;
      + name_prefix            = (known after apply)
      + owner_id               = (known after apply)
      + revoke_rules_on_delete = false
      + vpc_id                 = (known after apply)
    }

  # aws_subnet.private will be created
  + resource &quot;aws_subnet&quot; &quot;private&quot; {
      + arn                             = (known after apply)
      + assign_ipv6_address_on_creation = false
      + availability_zone               = &quot;ap-northeast-2a&quot;
      + availability_zone_id            = (known after apply)
      + cidr_block                      = &quot;10.0.1.0/24&quot;
      + id                              = (known after apply)
      + ipv6_cidr_block_association_id  = (known after apply)
      + map_public_ip_on_launch         = false
      + owner_id                        = (known after apply)
      + vpc_id                          = (known after apply)
    }

  # aws_subnet.private2 will be created
  + resource &quot;aws_subnet&quot; &quot;private2&quot; {
      + arn                             = (known after apply)
      + assign_ipv6_address_on_creation = false
      + availability_zone               = &quot;ap-northeast-2c&quot;
      + availability_zone_id            = (known after apply)
      + cidr_block                      = &quot;10.0.2.0/24&quot;
      + id                              = (known after apply)
      + ipv6_cidr_block_association_id  = (known after apply)
      + map_public_ip_on_launch         = false
      + owner_id                        = (known after apply)
      + vpc_id                          = (known after apply)
    }

  # aws_subnet.public will be created
  + resource &quot;aws_subnet&quot; &quot;public&quot; {
      + arn                             = (known after apply)
      + assign_ipv6_address_on_creation = false
      + availability_zone               = &quot;ap-northeast-2a&quot;
      + availability_zone_id            = (known after apply)
      + cidr_block                      = &quot;10.0.0.0/24&quot;
      + id                              = (known after apply)
      + ipv6_cidr_block_association_id  = (known after apply)
      + map_public_ip_on_launch         = true
      + owner_id                        = (known after apply)
      + tags                            = {
          + &quot;Name&quot; = &quot;public_subnet&quot;
        }
      + vpc_id                          = (known after apply)
    }

  # aws_vpc.main will be created
  + resource &quot;aws_vpc&quot; &quot;main&quot; {
      + arn                              = (known after apply)
      + assign_generated_ipv6_cidr_block = false
      + cidr_block                       = &quot;10.0.0.0/16&quot;
      + default_network_acl_id           = (known after apply)
      + default_route_table_id           = (known after apply)
      + default_security_group_id        = (known after apply)
      + dhcp_options_id                  = (known after apply)
      + enable_classiclink               = (known after apply)
      + enable_classiclink_dns_support   = (known after apply)
      + enable_dns_hostnames             = (known after apply)
      + enable_dns_support               = true
      + id                               = (known after apply)
      + instance_tenancy                 = &quot;default&quot;
      + ipv6_association_id              = (known after apply)
      + ipv6_cidr_block                  = (known after apply)
      + main_route_table_id              = (known after apply)
      + owner_id                         = (known after apply)
      + tags                             = {
          + &quot;Name&quot; = &quot;vpc_practice_02&quot;
        }
    }

Plan: 14 to add, 0 to change, 0 to destroy.
</code></pre></div>
<ul>
<li>
<p>결과</p>
<ul>
<li>
<p>콘솔에서 EC2 확인</p>
<p><img alt="Terraform Practice/Untitled%206.png" src="Untitled%206.png" /></p>
</li>
<li>
<p>배스천 인스턴스에 SSH 접속</p>
<p><img alt="Terraform Practice/Untitled%207.png" src="Untitled%207.png" /></p>
</li>
<li>
<p>자동으로 세팅 완료된 RDS 서버</p>
<p><img alt="Terraform Practice/Untitled%208.png" src="Untitled%208.png" /></p>
</li>
<li>
<p>Datagrip 터널링 세팅</p>
<p><img alt="Terraform Practice/Untitled%209.png" src="Untitled%209.png" /></p>
</li>
<li>
<p>Datagrip DB접속 세팅</p>
<p><img alt="Terraform Practice/Untitled%2010.png" src="Untitled%2010.png" /></p>
</li>
<li>
<p>Bastion을 이용한 RDS DB 접속 성공</p>
<p><img alt="Terraform Practice/Untitled%2011.png" src="Untitled%2011.png" /></p>
</li>
</ul>
</li>
</ul>
<h2 id="3-application-load-balancer">연습3 (Application Load Balancer)</h2>
<hr />
<ul>
<li>
<p>구성</p>
<p><img alt="Terraform Practice/Untitled%2012.png" src="Untitled%2012.png" /></p>
</li>
<li>
<p>코드</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>
</code></pre></div>
<ul>
<li>구성</li>
<li>코드</li>
</ul>
<div class="highlight"><pre><span></span><code>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>